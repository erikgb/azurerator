<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="779px" preserveAspectRatio="none" style="width:621px;height:779px;" version="1.1" viewBox="0 0 621 779" width="621px" zoomAndPan="magnify"><defs><filter height="300%" id="f1s58zwsstai0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="226" x="194.25" y="29.4023">Azurerator Sequence Flow</text><rect fill="#DDDDDD" height="732.2559" style="stroke:#A80036;stroke-width:1.0;" width="234" x="271.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="118" x="329.5" y="53.7676">Cluster resources</text><rect fill="#FFFFFF" filter="url(#f1s58zwsstai0)" height="46.6211" style="stroke:#000000;stroke-width:2.0;" width="361.5" x="80" y="213.3086"/><rect fill="#FFFFFF" filter="url(#f1s58zwsstai0)" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="524.5" x="80" y="404.1719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="42" x2="42" y1="123.6875" y2="686.9668"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="130" x2="130" y1="123.6875" y2="686.9668"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="353.5" x2="353.5" y1="123.6875" y2="686.9668"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="471.5" x2="471.5" y1="123.6875" y2="686.9668"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="552.5" x2="552.5" y1="123.6875" y2="686.9668"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="5" y="120.7344">Developer</text><ellipse cx="42.5" cy="50.1992" fill="#FEFECE" filter="url(#f1s58zwsstai0)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M42.5,58.1992 L42.5,85.1992 M29.5,66.1992 L55.5,66.1992 M42.5,85.1992 L29.5,100.1992 M42.5,85.1992 L55.5,100.1992 " fill="none" filter="url(#f1s58zwsstai0)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="5" y="699.502">Developer</text><ellipse cx="42.5" cy="712.4551" fill="#FEFECE" filter="url(#f1s58zwsstai0)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M42.5,720.4551 L42.5,747.4551 M29.5,728.4551 L55.5,728.4551 M42.5,747.4551 L29.5,762.4551 M42.5,747.4551 L55.5,762.4551 " fill="none" filter="url(#f1s58zwsstai0)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="90" y="120.7344">Azurerator</text><ellipse cx="130.5" cy="91.1992" fill="#FEFECE" filter="url(#f1s58zwsstai0)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="126.5,79.1992,132.5,74.1992,130.5,79.1992,132.5,84.1992,126.5,79.1992" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="90" y="699.502">Azurerator</text><ellipse cx="130.5" cy="718.4551" fill="#FEFECE" filter="url(#f1s58zwsstai0)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="126.5,706.4551,132.5,701.4551,130.5,706.4551,132.5,711.4551,126.5,706.4551" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1s58zwsstai0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="152" x="275.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="282.5" y="108.7344">AzureAdApplication</text><rect fill="#FEFECE" filter="url(#f1s58zwsstai0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="152" x="275.5" y="685.9668"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="282.5" y="706.502">AzureAdApplication</text><rect fill="#FEFECE" filter="url(#f1s58zwsstai0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="56" x="441.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="448.5" y="108.7344">Secret</text><rect fill="#FEFECE" filter="url(#f1s58zwsstai0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="56" x="441.5" y="685.9668"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="448.5" y="706.502">Secret</text><rect fill="#FEFECE" filter="url(#f1s58zwsstai0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="79" x="511.5" y="88.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="518.5" y="108.7344">Azure AD</text><rect fill="#FEFECE" filter="url(#f1s58zwsstai0)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="79" x="511.5" y="685.9668"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="518.5" y="706.502">Azure AD</text><rect fill="#EEEEEE" filter="url(#f1s58zwsstai0)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="614.5" x="0" y="154.3428"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="614.5" y1="154.3428" y2="154.3428"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="614.5" y1="157.3428" y2="157.3428"/><rect fill="#EEEEEE" filter="url(#f1s58zwsstai0)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="143" x="235.75" y="143.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129" x="241.75" y="160.2559">On create / update</text><polygon fill="#A80036" points="341.5,194.3086,351.5,198.3086,341.5,202.3086,345.5,198.3086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42.5" x2="347.5" y1="198.3086" y2="198.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="49.5" y="193.5664">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="62.5" y="193.5664">Apply config</text><path d="M80,213.3086 L154,213.3086 L154,220.3086 L144,230.3086 L80,230.3086 L80,213.3086 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.6211" style="stroke:#000000;stroke-width:2.0;" width="361.5" x="80" y="213.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="95" y="226.877">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="49" x="169" y="225.9434">[forever]</text><polygon fill="#A80036" points="341.5,247.9297,351.5,251.9297,341.5,255.9297,345.5,251.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="347.5" y1="251.9297" y2="251.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="247.1875">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="150.5" y="247.1875">watch for updates</text><polygon fill="#A80036" points="541,284.2402,551,288.2402,541,292.2402,545,288.2402" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="547" y1="288.2402" y2="288.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="283.498">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="150.5" y="283.498">check if application exists</text><polygon fill="#A80036" points="541,313.5508,551,317.5508,541,321.5508,545,317.5508" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="547" y1="317.5508" y2="317.5508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="312.8086">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="150.5" y="312.8086">register / update application</text><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="172.5" y1="346.8613" y2="346.8613"/><line style="stroke:#A80036;stroke-width:1.0;" x1="172.5" x2="172.5" y1="346.8613" y2="359.8613"/><line style="stroke:#A80036;stroke-width:1.0;" x1="131.5" x2="172.5" y1="359.8613" y2="359.8613"/><polygon fill="#A80036" points="141.5,355.8613,131.5,359.8613,141.5,363.8613,137.5,359.8613" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="342.1191">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="150.5" y="342.1191">generate new set of credentials</text><polygon fill="#A80036" points="541,385.1719,551,389.1719,541,393.1719,545,389.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="547" y1="389.1719" y2="389.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="384.4297">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="150.5" y="384.4297">register new credentials</text><path d="M80,404.1719 L349,404.1719 L349,411.1719 L339,421.1719 L80,421.1719 L80,404.1719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="524.5" x="80" y="404.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="224" x="95" y="417.7402">application already exists in AAD</text><polygon fill="#A80036" points="459.5,438.793,469.5,442.793,459.5,446.793,463.5,442.793" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="465.5" y1="442.793" y2="442.793"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="438.0508">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="150.5" y="438.0508">fetch existing credentials</text><polygon fill="#A80036" points="541,468.1035,551,472.1035,541,476.1035,545,472.1035" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="547" y1="472.1035" y2="472.1035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="467.3613">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="150.5" y="467.3613">invalidate older, non-used credentials</text><polygon fill="#A80036" points="341.5,504.4141,351.5,508.4141,341.5,512.4141,345.5,508.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="347.5" y1="508.4141" y2="508.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="137.5" y="503.6719">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="150.5" y="503.6719">update status subresource</text><polygon fill="#A80036" points="459.5,533.7246,469.5,537.7246,459.5,541.7246,463.5,537.7246" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="465.5" y1="537.7246" y2="537.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="137.5" y="532.9824">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="159.5" y="532.9824">inject credentials and metadata</text><rect fill="#EEEEEE" filter="url(#f1s58zwsstai0)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="614.5" x="0" y="566.3799"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="614.5" y1="566.3799" y2="566.3799"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="614.5" y1="569.3799" y2="569.3799"/><rect fill="#EEEEEE" filter="url(#f1s58zwsstai0)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="93" x="260.75" y="555.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="79" x="266.75" y="572.293">On deletion</text><polygon fill="#A80036" points="341.5,606.3457,351.5,610.3457,341.5,614.3457,345.5,610.3457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="42.5" x2="347.5" y1="610.3457" y2="610.3457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="49.5" y="605.6035">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="71.5" y="605.6035">delete</text><polygon fill="#A80036" points="459.5,635.6563,469.5,639.6563,459.5,643.6563,463.5,639.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="465.5" y1="639.6563" y2="639.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="137.5" y="634.9141">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="159.5" y="634.9141">delete</text><polygon fill="#A80036" points="541,664.9668,551,668.9668,541,672.9668,545,668.9668" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="130.5" x2="547" y1="668.9668" y2="668.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="137.5" y="664.2246">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="159.5" y="664.2246">delete</text><!--MD5=[76622c15aec2f9026abd80fbd17b53f6]
@startuml component
title Azurerator Sequence Flow
skinparam maxMessageSize 300
autonumber

actor developer as "Developer"
control azurerator as "Azurerator"

box "Cluster resources"
participant AzureAdApplication
participant Secret
end box

participant azuread as "Azure AD"

==On create / update==
developer -> AzureAdApplication: Apply config

loop forever
	azurerator -> AzureAdApplication: watch for updates
end

azurerator -> azuread: check if application exists
azurerator -> azuread: register / update application
azurerator -> azurerator: generate new set of credentials
azurerator -> azuread: register new credentials

group application already exists in AAD
    azurerator -> Secret: fetch existing credentials
    azurerator -> azuread: invalidate older, non-used credentials
end

azurerator -> AzureAdApplication: update status subresource
azurerator -> Secret: inject credentials and metadata

==On deletion==
    developer -> AzureAdApplication: delete
    azurerator -> Secret: delete
    azurerator -> azuread: delete

@enduml

PlantUML version 1.2021.00(Sun Jan 10 11:25:05 CET 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: NO
--></g></svg>